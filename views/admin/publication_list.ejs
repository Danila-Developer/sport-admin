<!DOCTYPE html>
<html lang="en">
<%- include('../inc/admin-head', {title: 'АДМИН-ПАНЕЛЬ' }) %>

	<body class="page-body">
		<%- include('../inc/admin-settings-pane') %>
			<div class="page-container">
				<%- include('../inc/admin-sidebar-menu', {menuElements: menuEl}) %>
					<div class="main-content">
						<%- include('../inc/admin-navbar-user') %>

							<!-- Content -->

							
							<%= menuEl.yt %>
							<div class="page-title">

								<div class="title-env">
									<h1 class="title">Публикации</h1>
									<p class="description">Добавьте публикации портала</p>
								</div>
								<div class="breadcrumb-env">
									<a href="http://localhost:3000/admin/edit-publication">
										<button class="btn btn-secondary">Добавить публикацию</button>
									</a>
									
								</div>
				
				
				
							</div>
				
				
				
				
							<div class="panel-body panel-border">
				
								<div class="row">
									<div class="col-sm-12">
				
										<!-- Table Model 2 -->
										<strong>Список публикации</strong>
				
										<table class="table table-model-2 table-hover">
											<thead>
												<tr>
													<th style="white-space: nowrap">Название</th>
													<th style="white-space: nowrap">Категория</th>
													<th style="white-space: nowrap">Дата</th>
													<th style="white-space: nowrap"></th>
												</tr>
											</thead>
				
											<tbody>
												<% allPublications.forEach(pub => { %>
													
													<tr style="cursor: pointer" >
														<td><%=pub.title%></td>
														<td><%=pub.category[0].category_name%></td>
														<td><%=pub.date%></td>
														<% if(!pub.is_published) { %>
														<td align="right"><button class="btn btn-primary btn-icon" style="width: 140px;" onclick="setPub('<%=pub.id%>', true)">
																<span>Опубликовать</span>
															</button></td>
														<% }else{ %>
															<td align="right"><button class="btn btn-white btn-icon" style="width: 140px;" onclick="setPub('<%=pub.id%>', false)">
																<span>Снять с публикации</span>
															</button></td>
															<% } %>
														
													</tr>
													<script>
														function setPub(pid, is_pub){
															console.log(`http://localhost:3000/admin/publications/set-published/${pid}/${is_pub}`)
															fetch(`http://localhost:3000/admin/publications/set-published/${pid}/${is_pub}`)
															.then(()=>{
																location.reload()
															})
															
														}
														
													</script>
												

												<% }) %>
					
											</tbody>
										</table>
				
										<script type="text/javascript">
				
										</script>
				
									</div>
								</div>
				
							</div>


								<!-- END Content -->
								<%- include('../inc/admin-footer') %>
					</div>
			</div>
			</div>
			<%- include('../inc/admin-loader') %>
				<%- include('../inc/admin-scripts') %>
	</body>

</html>